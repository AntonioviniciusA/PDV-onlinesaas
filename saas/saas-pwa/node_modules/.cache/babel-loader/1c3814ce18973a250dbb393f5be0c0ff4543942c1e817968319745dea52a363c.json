{"ast":null,"code":"// services/authService.js\nimport { apiNoAuth, apiAuth } from \"./conection\";\n\n// Cache para estado de autenticação\nlet authStateCache = {\n  isAuthenticated: null,\n  user: null\n};\nexport const AuthService = {\n  // Armazena os dados de autenticação\n  setAuthData: (token, user, remember = false) => {\n    const storage = remember ? localStorage : sessionStorage;\n    storage.setItem(\"token\", token);\n    storage.setItem(\"user\", JSON.stringify(user));\n    authStateCache = {\n      isAuthenticated: true,\n      user\n    };\n  },\n  // Limpa os dados de autenticação\n  clearAuth: () => {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"user\");\n    sessionStorage.removeItem(\"token\");\n    sessionStorage.removeItem(\"user\");\n    authStateCache = {\n      isAuthenticated: false,\n      user: null\n    };\n  },\n  // Login\n  login: async (loginData, remember = false) => {\n    try {\n      const response = await apiNoAuth.post(\"/auth/login\", loginData);\n      const {\n        token,\n        user\n      } = response.data;\n      AuthService.setAuthData(token, user, remember);\n      return {\n        token,\n        user\n      };\n    } catch (error) {\n      console.error(\"Erro ao fazer login:\", error);\n      throw error;\n    }\n  },\n  // Logout\n  logout: async () => {\n    try {\n      await apiAuth.post(\"/auth/logout\");\n      AuthService.clearAuth();\n      return true;\n    } catch (error) {\n      console.error(\"Erro ao fazer logout:\", error);\n      AuthService.clearAuth(); // Limpa mesmo em caso de erro\n      throw error;\n    }\n  },\n  // Register\n  register: async userData => {\n    try {\n      const response = await apiNoAuth.post(\"/auth/register\", userData);\n      return response.data;\n    } catch (error) {\n      console.error(\"Erro ao registrar usuário:\", error);\n      throw error;\n    }\n  },\n  // Reset Password\n  resetPassword: async email => {\n    try {\n      const response = await apiNoAuth.post(\"/auth/reset-password\", {\n        email\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"Erro ao redefinir senha:\", error);\n      throw error;\n    }\n  },\n  // Update Profile\n  updateProfile: async userData => {\n    try {\n      const response = await apiAuth.put(\"/auth/profile\", userData);\n\n      // Atualiza o usuário no storage se necessário\n      if (response.data.user) {\n        const user = response.data.user;\n        const currentUser = AuthService.getUser();\n        if (currentUser) {\n          const storage = localStorage.getItem(\"token\") ? localStorage : sessionStorage;\n          storage.setItem(\"user\", JSON.stringify(user));\n          authStateCache.user = user;\n        }\n      }\n      return response.data;\n    } catch (error) {\n      console.error(\"Erro ao atualizar perfil:\", error);\n      throw error;\n    }\n  },\n  // Change Password\n  changePassword: async (currentPassword, newPassword) => {\n    try {\n      const response = await apiAuth.post(\"/auth/change-password\", {\n        currentPassword,\n        newPassword\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"Erro ao alterar senha:\", error);\n      throw error;\n    }\n  },\n  // Verificar se está autenticado\n  isAuthenticated: async () => {\n    // console.log(\"authStateCache\", authStateCache);\n    if (authStateCache.isAuthenticated !== null) {\n      // console.log(\n      //   \"authStateCache.isAuthenticated2\",\n      //   authStateCache.isAuthenticated\n      // );\n      return authStateCache.isAuthenticated;\n    }\n    // console.log(\"iniciando verificacao de autenticacao\");\n    const token = AuthService.getToken();\n    if (!token) {\n      authStateCache.isAuthenticated = false;\n      return false;\n    }\n    try {\n      const response = await apiAuth.get(\"/verify-token\");\n      authStateCache = {\n        isAuthenticated: true,\n        user: response.data.user || AuthService.getUser()\n      };\n      return true;\n    } catch (error) {\n      AuthService.clearAuth();\n      return false;\n    }\n  },\n  // Obter token\n  getToken: () => {\n    return localStorage.getItem(\"token\") || sessionStorage.getItem(\"token\");\n  },\n  // Obter usuário\n  getUser: () => {\n    const user = localStorage.getItem(\"user\") || sessionStorage.getItem(\"user\");\n    return user ? JSON.parse(user) : null;\n  },\n  // Obter estado atual de autenticação (síncrono)\n  getAuthState: () => {\n    return {\n      ...authStateCache\n    };\n  }\n};\n\n// Debug logs (opcional)\nif (process.env.NODE_ENV !== \"production\") {\n  console.log(\"AuthService configurado com:\");\n  console.log(\"apiNoAuth base URL:\", apiNoAuth.defaults.baseURL);\n  console.log(\"apiAuth base URL:\", apiAuth.defaults.baseURL);\n}","map":{"version":3,"names":["apiNoAuth","apiAuth","authStateCache","isAuthenticated","user","AuthService","setAuthData","token","remember","storage","localStorage","sessionStorage","setItem","JSON","stringify","clearAuth","removeItem","login","loginData","response","post","data","error","console","logout","register","userData","resetPassword","email","updateProfile","put","currentUser","getUser","getItem","changePassword","currentPassword","newPassword","getToken","get","parse","getAuthState","process","env","NODE_ENV","log","defaults","baseURL"],"sources":["/home/v/Documentos/Github/PDV-onlinesaas/pdv-react-pwa/src/services/authServices.js"],"sourcesContent":["// services/authService.js\nimport { apiNoAuth, apiAuth } from \"./conection\";\n\n// Cache para estado de autenticação\nlet authStateCache = {\n  isAuthenticated: null,\n  user: null,\n};\n\nexport const AuthService = {\n  // Armazena os dados de autenticação\n  setAuthData: (token, user, remember = false) => {\n    const storage = remember ? localStorage : sessionStorage;\n    storage.setItem(\"token\", token);\n    storage.setItem(\"user\", JSON.stringify(user));\n    authStateCache = { isAuthenticated: true, user };\n  },\n\n  // Limpa os dados de autenticação\n  clearAuth: () => {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"user\");\n    sessionStorage.removeItem(\"token\");\n    sessionStorage.removeItem(\"user\");\n    authStateCache = { isAuthenticated: false, user: null };\n  },\n\n  // Login\n  login: async (loginData, remember = false) => {\n    try {\n      const response = await apiNoAuth.post(\"/auth/login\", loginData);\n      const { token, user } = response.data;\n\n      AuthService.setAuthData(token, user, remember);\n      return { token, user };\n    } catch (error) {\n      console.error(\"Erro ao fazer login:\", error);\n      throw error;\n    }\n  },\n\n  // Logout\n  logout: async () => {\n    try {\n      await apiAuth.post(\"/auth/logout\");\n      AuthService.clearAuth();\n      return true;\n    } catch (error) {\n      console.error(\"Erro ao fazer logout:\", error);\n      AuthService.clearAuth(); // Limpa mesmo em caso de erro\n      throw error;\n    }\n  },\n\n  // Register\n  register: async (userData) => {\n    try {\n      const response = await apiNoAuth.post(\"/auth/register\", userData);\n      return response.data;\n    } catch (error) {\n      console.error(\"Erro ao registrar usuário:\", error);\n      throw error;\n    }\n  },\n\n  // Reset Password\n  resetPassword: async (email) => {\n    try {\n      const response = await apiNoAuth.post(\"/auth/reset-password\", { email });\n      return response.data;\n    } catch (error) {\n      console.error(\"Erro ao redefinir senha:\", error);\n      throw error;\n    }\n  },\n\n  // Update Profile\n  updateProfile: async (userData) => {\n    try {\n      const response = await apiAuth.put(\"/auth/profile\", userData);\n\n      // Atualiza o usuário no storage se necessário\n      if (response.data.user) {\n        const user = response.data.user;\n        const currentUser = AuthService.getUser();\n\n        if (currentUser) {\n          const storage = localStorage.getItem(\"token\")\n            ? localStorage\n            : sessionStorage;\n          storage.setItem(\"user\", JSON.stringify(user));\n          authStateCache.user = user;\n        }\n      }\n\n      return response.data;\n    } catch (error) {\n      console.error(\"Erro ao atualizar perfil:\", error);\n      throw error;\n    }\n  },\n\n  // Change Password\n  changePassword: async (currentPassword, newPassword) => {\n    try {\n      const response = await apiAuth.post(\"/auth/change-password\", {\n        currentPassword,\n        newPassword,\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"Erro ao alterar senha:\", error);\n      throw error;\n    }\n  },\n  // Verificar se está autenticado\n  isAuthenticated: async () => {\n    // console.log(\"authStateCache\", authStateCache);\n    if (authStateCache.isAuthenticated !== null) {\n      // console.log(\n      //   \"authStateCache.isAuthenticated2\",\n      //   authStateCache.isAuthenticated\n      // );\n      return authStateCache.isAuthenticated;\n    }\n    // console.log(\"iniciando verificacao de autenticacao\");\n    const token = AuthService.getToken();\n    if (!token) {\n      authStateCache.isAuthenticated = false;\n      return false;\n    }\n\n    try {\n      const response = await apiAuth.get(\"/verify-token\");\n      authStateCache = {\n        isAuthenticated: true,\n        user: response.data.user || AuthService.getUser(),\n      };\n      return true;\n    } catch (error) {\n      AuthService.clearAuth();\n      return false;\n    }\n  },\n\n  // Obter token\n  getToken: () => {\n    return localStorage.getItem(\"token\") || sessionStorage.getItem(\"token\");\n  },\n\n  // Obter usuário\n  getUser: () => {\n    const user = localStorage.getItem(\"user\") || sessionStorage.getItem(\"user\");\n    return user ? JSON.parse(user) : null;\n  },\n\n  // Obter estado atual de autenticação (síncrono)\n  getAuthState: () => {\n    return { ...authStateCache };\n  },\n};\n\n// Debug logs (opcional)\nif (process.env.NODE_ENV !== \"production\") {\n  console.log(\"AuthService configurado com:\");\n  console.log(\"apiNoAuth base URL:\", apiNoAuth.defaults.baseURL);\n  console.log(\"apiAuth base URL:\", apiAuth.defaults.baseURL);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}